/*  .--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--. 
   / .. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \
   \ \/\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ \/ /
    \/ /`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'\/ / 
    / /\                                                                                            / /\ 
   / /\ \  ▄▄▄▄    ██▓    ▄▄▄      ▄████▄   ██ ▄█▀      ███▄ ▄███▓ ▄▄▄        ▄████  ██▓ ▄████▄    / /\ \
   \ \/ / ▓█████▄ ▓██▒   ▒████▄   ▒██▀ ▀█   ██▄█▒      ▓██▒▀█▀ ██▒▒████▄     ██▒ ▀█▒▓██▒▒██▀ ▀█    \ \/ /
    \/ /  ▒██▒ ▄██▒██░   ▒██  ▀█▄ ▒▓█    ▄ ▓███▄░      ▓██    ▓██░▒██  ▀█▄  ▒██░▄▄▄░▒██▒▒▓█    ▄    \/ / 
    / /\  ▒██░█▀  ▒██░   ░██▄▄▄▄██▒▓▓▄ ▄██▒▓██ █▄      ▒██    ▒██ ░██▄▄▄▄██ ░▓█  ██▓░██░▒▓▓▄ ▄██▒   / /\ 
   / /\ \ ░▓█  ▀█▓░██████▒▓█   ▓██▒ ▓███▀ ░▒██▒ █▄ ██▓ ▒██▒   ░██▒ ▓█   ▓██▒░▒▓███▀▒░██░▒ ▓███▀ ░  / /\ \
   \ \/ / ░▒▓███▀▒░ ▒░▓  ░▒▒   ▓▒█░ ░▒ ▒  ░▒ ▒▒ ▓▒ ▒▓▒ ░ ▒░   ░  ░ ▒▒   ▓▒█░ ░▒   ▒ ░▓  ░ ░▒ ▒  ░  \ \/ /
    \/ /  ▒░▒   ░ ░ ░ ▒  ░ ▒   ▒▒ ░ ░  ▒   ░ ░▒ ▒░ ░▒  ░  ░      ░  ▒   ▒▒ ░  ░   ░  ▒ ░  ░  ▒      \/ / 
    / /\   ░    ░   ░ ░    ░   ▒  ░        ░ ░░ ░  ░   ░      ░     ░   ▒   ░ ░   ░  ▒ ░░           / /\ 
   / /\ \  ░          ░  ░     ░  ░ ░      ░  ░     ░         ░         ░  ░      ░  ░  ░ ░        / /\ \
   \ \/ /       ░                 ░                 ░                                   ░          \ \/ /
    \/ /                                                                                            \/ / 
    / /\.--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--..--./ /\ 
   / /\ \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \.. \/\ \
   \ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `'\ `' /
    `--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--'`--' */
{ inputs, settings, ... }:

{
  flake.nixosModules.blackmagic = { config, lib, ... }:
  let
    cfg = config.witchcraft.blackmagic;
    hm = home-manager.users.${settings.username};
  in
  {
    imports = [];

    options.witchcraft.blackmagic = {
      enable = lib.mkEnableOptions "BlackMagic";
    };

    config = lib.mkIf cfg.enable {
      programs = {
        hyprland = {
          withUWSM = true;
        };
      };
      hm = {
        imports = [
          ./config
          ./pkgs
          ./services
          ./theme
        ];
        wayland.windowManager.hyprland = {
          enable = true;
          package = inputs.hyprland.packages.${pkgs.system}.hyprland;
          portalPackage = inputs.hyprland.packages.${pkgs.system}.xdg-desktop-portal-hyprland;
          systemd.enable = false;
          xwayland.enable = true;
        };
      };
    };
  };
}